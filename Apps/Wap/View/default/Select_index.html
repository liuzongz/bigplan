<!DOCTYPE html>
<include file="Public:head2" />
<script type="text/javascript" src="__JS__/constor.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ihDDHwCX7FaUlPhKV1o9iQa5OLBAu0lE"></script>
<link rel="stylesheet" href="http://at.alicdn.com/t/font_7jzqkdsq0h1o47vi.css">
<style type="text/css">
    body{background-color: #eee;}
    header{ max-width: 768px;background-color: #fff; }
    .back{z-index: 99; position: absolute;top:0;left: 0; line-height: 2rem;width: 2rem;height: 2rem; text-align: center;}
    .city_select{width:100%;height: 2rem;line-height: 2rem;text-align: center;}
    .cityA{padding: .3rem 0; background: #fff;margin: .5rem 0;border-bottom: 1px solid #aaa;}

    .cityA .setCity{max-width: 3rem; margin-left:.5rem;text-align: center;line-height: 1.4rem;   font-size: .6rem;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 1;overflow: hidden;word-break: break-all; }

    .cityA .lc{line-height: 1.4rem;margin:  0 .1rem; }
    .ipk{margin: 0 .5rem;height: 1.4rem; background: #eee;border:1px solid #eee;border-radius: .1rem;position: relative;}
    .input_text{border:none;background: #eee;color: #a6a6a6;}
    .ipk .iconS{width: 1.5rem;text-align: center;line-height: 1.4rem;}
    .ipk .iconS i{font-size: .8rem;color: #a6a6a6;}
    .ipk .pot{position: absolute;width: 1.2rem;text-align: center; right: .2rem;top:0;line-height: 1.4rem;}
    .ipk .pot i{opacity: .5;}
    .gb{background-color:#fff;margin-top: .5rem;}
    .gb .la{padding-left: .5rem;width: 1.5rem; line-height: 2rem;}
    .gb .gc{line-height: 2rem;}
    .gb .sr{ width: 2rem;text-align: center;line-height: 2rem;}

    .selectBody,.location{width: 100%;background-color: #fff;position: absolute;top:0;left: 0;z-index: 999;min-height: 100%;}
    #JS_header{position: fixed;width: 100%;top:0; max-width: 768px;background-color: #fff; z-index: 999;}
    #JS_header .back{z-index: 99; position: absolute;top:0;left: 0; line-height: 2rem;width: 2rem;height: 2rem; text-align: center;}
    #JS_header .city_select{width:100%;height: 2rem;line-height: 2rem;text-align: center;}
    .warpCityS{background-color: #eee; padding-bottom: .6rem;}
    ul.cityStyle li{float: left;width: 4.2rem;margin:.2rem 0 .2rem .6rem; border: 1px solid #b5b5b5;border-radius: .1rem; text-align: center;height: 1.6rem;line-height: 1.6rem;text-align: center;font-size: .6rem;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 1;overflow: hidden;word-break: break-all;}
    .warpCityS .song p.forLeftM{padding:.6rem 0 .3rem .6rem;}
    .cityAll{}
    .cityAll>ul>li{background-color: #eee;}
    .cityAll>ul>li>a{position: relative; top: -2rem;display: block; height: 0; overflow: hidden;}
    .cityAll>ul>li>ul{background: #fff;}
    .cityAll>ul>li>ul>li{background-color: white;margin: 0 0 0 .6rem; line-height: 2rem;border-bottom: 1px solid #e2e2e2;}
    .rightNavCity{position: fixed;right:0;top:4.1rem;padding: 0 .2rem;border-radius: .1rem;}
    .rightNavCity ul li{text-align: center;}
    .rightNavCity ul li a{color: #00aa88;text-align: center;font-size: .4rem;}
    .floatUp{position: fixed;top:50%; left:5rem; text-align: center;width: 6rem;height: 3rem; }
    .floatUp .textClass{padding: .3rem .4rem;font-size: 1.5rem; background:rgba(0,0,0,.6); color:white; }

    .cityB{width: 100%;}
    .cityB .back_loctaion{width: 2rem;height: 2rem;line-height: 2rem;text-align: center;}
    .cityB .lc{line-height: 1.4rem;margin:  0 .1rem; }
    .cityB .ipk{margin: .3rem .5rem;height: 1.4rem;line-height: 1.4rem; background: #eee;border:1px solid #eee;border-radius: .1rem;position: relative;}
    .maker{width: 1rem;height: 1rem;position: absolute;top:6rem;left: 7.5rem; }
    .maker i{color: red;}
    .seachAdd{width: 100%;position: absolute;overflow: auto; background: #eee;}
    .top5{top:5rem;left: 0;}
    .top12{top:12rem;left: 0;}
    .seachAdd ul{background: #fff;}
    .seachAdd ul li{background: #fff;border-bottom: 1px solid #e2e2e2;margin-left:.5rem;padding: 0 .4rem .4rem 0; }
    .seachAdd ul li p.p1 i{color:#a6a6a6;}
    .seachAdd ul li p.p1 em{color: #333;font-size: .7rem;}
    .seachAdd ul li p.p2{padding-left: 1rem;color: #a6a6a6;}
</style>
</head>
<header>
    <div style="position: relative;">
        <div class="back" onclick="fnClose();"><i class="myF icon-left"></i></div>
        <div class="city_select">
            选择收货地址
        </div>
    </div>
</header>
<section>
    <div class="cityA flex-wrap">
        <div class="flex-wrap none" id="JS_cityOut">
            <div class="setCity flex-con" id="JS_setCity">
                北京
            </div>
            <div class="lc">
                <i class="myF icon-down" style="font-size: .6rem;"></i>
            </div>
        </div>
        <div class="flex-con">
            <div class="flex-wrap ipk">
                <div class="iconS">
                    <i class="myF icon-sousuo-sousuo"></i>
                </div>
                <input class="flex-con input_text" id="JS_search" value="" type="text" placeholder="查找小区/大厦/学校等">
                <div class="pot none" id="JS_close">
                    <i class="myF icon-guanbi1"></i>
                </div>
            </div>
        </div>

    </div>
    <div class="gb flex-wrap" onclick="$('#JS_location').removeClass('none');" style="color: #4a964d;" >
        <div class="la">
            <i class="myF icon-dingwei1"></i>
        </div>
        <div class="flex-con gc">
            定位当前位置
        </div>
        <div class="sr">
            <i class="myF icon-right"></i>
        </div>
    </div>
</section>
<footer>
    <div class="selectBody none" id="JS_cityChange">
        <div id="JS_header">
            <div style="position: relative;">
                <div class="back" onclick="$('#JS_cityChange').addClass('none');"><i class="myF icon-left"></i></div>
                <div class="city_select">
                    选择城市
                </div>
            </div>
        </div>
        <div style="height: 2rem;"></div>
        <div class="cityAll clearfix">
            <ul class="chao" id="JS_chao">
                <li class="item" data-tag="热门">
                    <a name="remen" id="JS_remen"> </a>
                    <div class="warpCityS" style="border-bottom: 1px solid #e2e2e2;">
                        <div class="song">
                            <p class="forLeftM">热门城市</p>
                            <ul class="cityStyle clearfix">
                                <li>武汉</li>
                                <li>成都</li>
                                <li>重庆</li>
                                <li>广州</li>
                                <li>杭州</li>
                                <li>南京</li>
                                <li>上海</li>
                            </ul>
                        </div>
                    </div>
                </li>
                <foreach name="city" item="list" key="k">
                    <li class="item" data-tag="{$k}"><a class="itema" name="{$k}" id="JS_{$k}" ></a><i class="forlt">{$k}</i>
                        <ul class="lei">
                            <foreach name="list" item="v">
                                <li>{$v}</li>
                            </foreach>
                        </ul>
                    </li>
                </foreach>
            </ul>
        </div>
        <div class="rightNavCity" id="JS_rightNavCity">
            <ul class="cityMoat">
                <li><a href="#remen">热门</a></li>
                <li><a href="#A">A</a></li>
                <li><a href="#B">B</a></li>
                <li><a href="#C">C</a></li>
                <li><a href="#D">D</a></li>
                <li><a href="#E">E</a></li>
                <li><a href="#F">F</a></li>
                <li><a href="#G">G</a></li>
                <li><a href="#H">H</a></li>
                <li><a href="#I">I</a></li>
                <li><a href="#J">J</a></li>
                <li><a href="#K">K</a></li>
                <li><a href="#L">L</a></li>
                <li><a href="#M">M</a></li>
                <li><a href="#N">N</a></li>
                <li><a href="#O">O</a></li>
                <li><a href="#P">P</a></li>
                <li><a href="#Q">Q</a></li>
                <li><a href="#R">R</a></li>
                <li><a href="#S">S</a></li>
                <li><a href="#T">T</a></li>
                <li><a href="#U">U</a></li>
                <li><a href="#V">V</a></li>
                <li><a href="#W">W</a></li>
                <li><a href="#X">X</a></li>
                <li><a href="#Y">Y</a></li>
                <li><a href="#Z">Z</a></li>
            </ul>
        </div>
        <div class="floatUp none" id="JS_floatUp">
            <em class="textClass">A</em>
        </div>
    </div>
    <div class="location none" id="JS_location" >
        <div class="cityB flex-wrap" onclick="backLocation();">
            <div class="back_loctaion">
                <i class="myF icon-left"></i>
            </div>
            <div class="flex-con">
                <div class="flex-wrap ipk">
                    <div class="iconS">
                        <i class="myF icon-sousuo-sousuo"></i>
                    </div>
                    <div class=" flex-con" style="color: #a6a6a6;">查找小区/大厦/学校等</div>
                </div>
            </div>
        </div>
        <div id="allmap" style="width: 100%;height: 10rem;">
        </div>
        <div class="maker"><i class="myF icon-location"></i></div>
        <div class="seachAdd top12" id="JS_seachTop12">
            <ul>
                <li>
                    <p class="p1"><i class="myF icon-location"></i><em>武汉天气</em></p>
                    <p class="p2">湖北省武汉市硚口区园博园</p>
                </li>
            </ul>
        </div>
    </div>
    <div class="seachAdd top5 none" id="JS_seachAdd">
        <ul>
            <li>
                <p class="p1"><i class="myF icon-location"></i><em>武汉天气</em></p>
                <p class="p2">湖北省武汉市硚口区园博园</p>
            </li>
        </ul>
    </div>
</footer>
<script type="text/javascript">
    //页面互相跳转的操作
    var Setcity = $('#JS_setCity').text();  //当前选择的城市
    var widthRem = $(window).width()/16;   //rem转换成px
    function backLocation(){
        $('#JS_location').addClass('none');
        $('#JS_cityOut').removeClass('none');
        $('#JS_search').val('').focus();
        $('#JS_close').addClass('none');
        $('#JS_seachAdd').addClass('none');
    }
    $('#JS_close').on({
        'click':function() {
            $(this).addClass('none');
            $('#JS_search').val('').focus();
        }
    });
    $('#JS_cityOut').on({
        'click':function() {
            $('#JS_cityChange').removeClass('none');
        }
    });
    $('#JS_search').on({
        "input propertychange":function(){
            if($(this).val()!=="" ||$(this).val() !=='') {
                $('#JS_close').removeClass('none');
            }
            else  $('#JS_close').addClass('none');
        },
        'click' : function() {
            $('#JS_cityOut').removeClass('none');
            $('#JS_seachAdd').removeClass('none');
        },
        'input' : function(){
            var keyword = $(this).val();
            Jiniu.ajax('{:U("search")}','city=' + Setcity + '&keyword=' + keyword, function(ex){
                if (ex.error == 200) {
                    var data = ex.data,str = '';
                    $.each(data, function(index,item){
                        str += '';
                    });
                    $('#JS_seachAdd').html(str);
                } else {
                    alert(ex.msg);
                }
            })
        }
    });
    function fnClose(){
        if($('#JS_cityOut').hasClass('none')== true){
            window.location.href = "http://t0.jiniu.cc/Wap/Index/index0106.html";
        }else {
            $('#JS_cityOut').addClass('none');
            $('#JS_seachAdd').addClass('none');
        }
    }
    $('#JS_chao li ul li').each(function(){
        $(this).click(function(){
            $('#JS_cityChange').addClass('none');
            $('#JS_setCity').text( $(this).text());
        })
    });

    var seachAddHight = $(window).height(); //设置周边信息div的总高度
    $('#JS_seachAdd').height(seachAddHight-widthRem*5);
    $('#JS_seachTop12').height(seachAddHight-widthRem*12);
    var map = new BMap.Map('allmap');
    map.centerAndZoom(Setcity,15);


    /*map.addEventListener("dragstart", function(evt){　
     　var cp = map.getCenter();
     alert(cp.lng + "," + cp.lat);
     });*/

    /*map.addEventListener("dragging", function(evt){
     var offsetPoint = new BMap.Pixel(evt.offsetX, evt.offsetY);   //记录鼠标当前点坐标<br>
     // alert(offsetPoint.x+","+offsetPointY);
     });
     */
    map.addEventListener("dragend", function showInfo(){
        var cp = map.getCenter();
        alert(cp.lng + "," + cp.lat);
    });
    /* var x, y;
     if(navigator.geolocation){
     navigator.geolocation.getCurrentPosition(function (position) {
     x = position.coords.longitude;
     y = position.coords.latitude;
     var gpsPoint = new BMap.Point(x, y);
     BMap.Convertor.translate(gpsPoint, 0, function (point) {
     var geoc = new BMap.Geocoder();
     geoc.getLocation(point, function (rs) {
     var addComp = rs.addressComponents;
     var province = addComp.province;
     var city = addComp.city;
     var district =addComp.district;
     var street= addComp.street;
     var streetNumber = addComp.streetNumber;
     textName.text(streetNumber);
     alert('您的位置：'+rs.point.lng+','+rs.point.lat);
     });
     });
     },showError);
     }
     function showError(){
     function myFun(result){
     var cityName = result.name;
     /!* map.setCenter(cityName);*!/
     textName.text(cityName);
     }
     var myCity = new BMap.LocalCity();
     myCity.get(myFun);
     }
     */

    $(function() {                                       //城市选择器页面
        var length = $('#JS_rightNavCity ul li').length;
        var liHight = ($(window).height() - widthRem*4) /length; //计算4rem的高度
        $(window).resize(function () {
            fnSetliHight();
        });
        function fnSetliHight(){
            $('#JS_rightNavCity ul li').css({'height': liHight, 'line-height': liHight + 'px'});
        }fnSetliHight();
    });
    tap = 1;
    $(window).on({
        scroll:function(){
            $('#JS_floatUp').removeClass('none');
            log();
        },touchmove:function(){
            tap = 0;
        },touchend:function () {
            tap = 1;
        }
    });
    var fnOutNone = function () {
        $('#JS_floatUp').addClass('none');
    };
    var timer = null;
    var oldTop = newTop = $(window).scrollTop();
    function log(){
        if(timer) clearTimeout(timer);
        newTop = $(window).scrollTop();
        if(newTop === oldTop && tap) {
            clearTimeout(timer);
            setTimeout(fnOutNone,1000);
        } else{
            oldTop = newTop;
            timer = setTimeout(log,100);
        }
    }
    $(window).scroll(function(){
        var menu = $("#JS_floatUp em");
        var items = $("#JS_chao").find(".item");
        items.each(function(){
            var m = $(this);
            var mText = m.data('tag');
            var itemsTop = m.offset().top- widthRem;
            var p = $(window).scrollTop();
            if(p -itemsTop > 0 ){
                menu.text(mText);
            }else{
                return false;
            }
        });
    });
</script>
</html>